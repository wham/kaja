syntax = "proto3";

package ecommerce.store;

import "google/protobuf/timestamp.proto";
import "common/types.proto";
import "store/product.proto";

// Order status enum
enum OrderStatus {
  ORDER_STATUS_UNSPECIFIED = 0;
  ORDER_STATUS_PENDING = 1;
  ORDER_STATUS_CONFIRMED = 2;
  ORDER_STATUS_SHIPPED = 3;
  ORDER_STATUS_DELIVERED = 4;
  ORDER_STATUS_CANCELLED = 5;
  ORDER_STATUS_REFUNDED = 6;
}

// Payment method
enum PaymentMethod {
  PAYMENT_METHOD_UNSPECIFIED = 0;
  PAYMENT_METHOD_CREDIT_CARD = 1;
  PAYMENT_METHOD_DEBIT_CARD = 2;
  PAYMENT_METHOD_PAYPAL = 3;
  PAYMENT_METHOD_CRYPTO = 4;
}

// Order with complex nesting
message Order {
  string id = 1;
  string user_id = 2;
  OrderStatus status = 3;
  
  message LineItem {
    string product_id = 1;
    string variant_id = 2;
    int32 quantity = 3;
    common.Money unit_price = 4;
    common.Money total_price = 5;
    Product product = 6;
  }
  
  repeated LineItem items = 4;
  common.Money subtotal = 5;
  common.Money tax = 6;
  common.Money shipping = 7;
  common.Money total = 8;
  
  message ShippingInfo {
    common.Address address = 1;
    string carrier = 2;
    string tracking_number = 3;
    google.protobuf.Timestamp estimated_delivery = 4;
  }
  
  ShippingInfo shipping_info = 9;
  
  message PaymentInfo {
    PaymentMethod method = 1;
    string transaction_id = 2;
    common.Money amount = 3;
    google.protobuf.Timestamp processed_at = 4;
  }
  
  PaymentInfo payment = 10;
  common.AuditInfo audit = 11;
}

message CreateOrderRequest {
  string user_id = 1;
  
  message Item {
    string product_id = 1;
    string variant_id = 2;
    int32 quantity = 3;
  }
  
  repeated Item items = 2;
  common.Address shipping_address = 3;
  PaymentMethod payment_method = 4;
}

message CreateOrderResponse {
  Order order = 1;
}

message GetOrderRequest {
  string id = 1;
}

message GetOrderResponse {
  Order order = 1;
}

message UpdateOrderStatusRequest {
  string id = 1;
  OrderStatus status = 2;
}

message UpdateOrderStatusResponse {
  Order order = 1;
}

// Order service
service OrderService {
  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
  rpc GetOrder(GetOrderRequest) returns (GetOrderResponse);
  rpc UpdateOrderStatus(UpdateOrderStatusRequest) returns (UpdateOrderStatusResponse);
}
