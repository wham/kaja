- See [Development](README.md#development) for run/test instructions.
- Re-generate Protobuf files: run `scripts/server`.
- Add code comments only for tricky parts.
- Use "configuration" not "config" in code (e.g., "getConfiguration").
- Use `scripts/server` or `scripts/desktop`, not `go build` directly.
- Use https://primer.style/product/getting-started/react/. Prefer Primer components; avoid custom styling.
- Don't edit generated files‚Äîthey're overwritten.
  - `ui/src/wailsjs/**` generated by Wails.

## üìÅ Directory Structure

### Root Directories

- **`ui/`** - React/TypeScript frontend with Primer components
- **`server/`** - Go server for Docker/production
- **`desktop/`** - Wails desktop wrapper
- **`workspace/`** - Demo apps (gRPC and Twirp servers)
- **`scripts/`** - Build and dev scripts
- **`docs/`** - Documentation assets

### üî® Build and Work Directories

Multiple build directories serve different purposes:

#### `/build` (Root Level, Git Ignored)
**Purpose:** Shared build artifacts for server and desktop
**Created by:** `scripts/server` and `scripts/desktop`
**Contents:**
- `protoc-gen-ts` - Bundled TypeScript protobuf plugin
- Protobuf tools (`protoc-gen-go`, `protoc-gen-twirp`, `protoc-gen-go-grpc`)

**Why it exists:** Runtime tools for compiling user `.proto` files. `protoc-gen-ts` bundled from `ui/node_modules` via esbuild.

#### `/server/build` (Git Ignored)
**Purpose:** Server production UI artifacts
**Created by:** `go run server/cmd/build-ui/main.go`
**Contents:**
- `main.js` - Bundled React app (esbuild)
- `main.css` - Bundled CSS
- `codicon-37A3DWZT.ttf` - Monaco font
- `monaco.*.worker.js` - Monaco workers (json, css, html, ts, editor)

**Why it exists:** Files embedded via `//go:embed` in `server/assets_production.go` for Docker deployment.

#### `/desktop/build/bin` (Git Ignored)
**Purpose:** Wails desktop binaries
**Created by:** `wails build` (via `wails dev`)
**Contents:** Platform-specific executables

**Why it exists:** Desktop app distribution output.

#### `/desktop/build/sources/{project}` (Git Ignored)
**Purpose:** Runtime-generated TypeScript from user `.proto` files
**Created by:** Runtime protoc in `server/pkg/api/compiler.go`
**Contents:** Generated TypeScript RPC client code

**Why it exists:** User `.proto` files compiled to TypeScript via `protoc-gen-ts`, bundled for Monaco autocomplete.

#### `/desktop/frontend/dist` (Git Ignored)
**Purpose:** Desktop frontend assets from server build
**Created by:** `scripts/desktop`
**Contents:**
- `main.js`, `main.css`, `codicon-37A3DWZT.ttf`
- `static/` with `index.html`, `favicon.*`

**Why it exists:** Desktop reuses server UI bundle (single source). Wails embeds via `//go:embed all:frontend/dist`.

#### `/ui/node_modules` (Git Ignored)
**Purpose:** NPM dependencies
**Created by:** `npm install`

### üöÄ Development vs Production Builds

#### Server Development (`scripts/server`)
**Build Process:**
1. Install protoc plugins to `/build`
2. Build demo workspace apps
3. Run `go run server/cmd/build-ui/main.go` - creates bundles in `server/build/`
4. Generate server protobufs
5. Run server with `-tags development`

**Development Mode:**
- Uses `server/assets_development.go` (build tag: `development`)
- Reads files from disk (no embed)
- Hot reloading enabled
- Binary: `/tmp/kaja`

#### Server Production (Dockerfile)
**Build Process:**
1. `npm ci` in `ui/`
2. Run tests (if `RUN_TESTS=true`)
3. `go run server/cmd/build-ui/main.go` - creates bundles
4. `go build ./cmd/server` (no development tag)

**Production Mode:**
- Uses `server/assets_production.go` (default)
- Files embedded via `//go:embed`
- Single binary with all assets
- Optimized for Docker

#### Desktop Development (`scripts/desktop`)
**Build Process:**
1. Build demo workspace apps
2. Run `go run server/cmd/build-ui/main.go`
3. Copy `server/build/*` to `desktop/frontend/dist/`
4. Copy `server/static/*` to `desktop/frontend/dist/`
5. Run `wails dev`

**Desktop Mode:**
- Native window and OS integration
- Same UI bundle as server
- Hot reload enabled
- Embeds via `//go:embed all:frontend/dist`

#### Desktop Production
**Build Process:**
- `wails build` creates binaries in `desktop/build/bin/`
- Assets embedded in binary

### üìú Key Build Scripts

- **`scripts/server`** - Dev server (Go + React)
- **`scripts/desktop`** - Desktop dev (Wails)
- **`scripts/docker`** - Docker build and run
- **`scripts/common`** - Shared demo functions

### ‚ö†Ô∏è Generated Files (Do Not Edit)

- `ui/src/wailsjs/**` - Wails CLI
- `ui/src/server/**` - protoc from `server/proto/api.proto`
- `server/proto/**/*.pb.go` - protoc-gen-go
- `server/proto/**/*.twirp.go` - protoc-gen-twirp
- `/build/sources/{project}/**` - Runtime from user `.proto` files

### üí° Why Multiple Build Directories?

1. **`/build`** - Shared tooling for server and desktop runtime
2. **`/server/build`** - Server UI artifacts for embedding
3. **`/desktop/build/`** - Desktop artifacts (binaries, runtime sources)
4. **`/desktop/frontend/dist`** - Desktop frontend from server (single source)

Benefits:
- **Server** embeds UI, no external dependencies
- **Desktop** reuses same UI in native window
- **Runtime** protobuf compilation for user projects
- **Development** hot reloading ‚ôªÔ∏è
- **Production** optimized embedded assets üì¶
