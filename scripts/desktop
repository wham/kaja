#!/bin/bash
set -e

source "$(dirname "$0")/common"

# Check if Wails is installed, if not ask for user confirmation to install it using Homebrew
if ! command -v wails &> /dev/null
then
    echo "Wails is not installed."
    read -p "Would you like to install Wails using Homebrew? (y/n) " -n 1 -r
    echo    # Move to a new line
    if [[ $REPLY =~ ^[Yy]$ ]]
    then
        echo "Installing Wails using Homebrew..."
        brew install wails
    else
        echo "Wails installation skipped. Exiting script."
        exit 1
    fi
fi

setup_trap

cd "$(dirname "$0")/.."

export GOBIN=$PWD/server/build
export PATH=$GOBIN:$PATH

build_demo_apps
start_demo_apps

cd "./server"
go run cmd/build-ui/main.go

cd ".."
rm -rf desktop/frontend/dist || true
mkdir -p desktop/frontend/dist
cp server/build/main.css desktop/frontend/dist/main.css
cp server/build/main.js desktop/frontend/dist/main.js
cp -r server/static desktop/frontend/dist/
mv desktop/frontend/dist/static/index.html desktop/frontend/dist/index.html

cd "./desktop"
wails dev